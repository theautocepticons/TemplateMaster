<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Note Template Generator</title>
    <style>
        /* Base styles and CSS variables */
        :root {
            --primary-color: #3498db;
            --primary-hover: #2980b9;
            --secondary-color: #27ae60;
            --secondary-hover: #219653;
            --danger-color: #e74c3c;
            --danger-hover: #c0392b;
            --bg-color: #f5f7fa;
            --card-bg: white;
            --text-color: #333;
            --border-color: #f0f0f0;
            --highlight-bg: #f1f9ff;
        }
        
        /* Theme definitions */
        body.theme-blue {
            --primary-color: #3498db;
            --primary-hover: #2980b9;
            --secondary-color: #27ae60;
            --secondary-hover: #219653;
            --danger-color: #e74c3c;
            --danger-hover: #c0392b;
            --bg-color: #f5f7fa;
            --card-bg: white;
            --text-color: #333;
            --border-color: #f0f0f0;
            --highlight-bg: #f1f9ff;
        }
        
        body.theme-purple {
            --primary-color: #9b59b6;
            --primary-hover: #8e44ad;
            --secondary-color: #27ae60;
            --secondary-hover: #219653;
            --danger-color: #e74c3c;
            --danger-hover: #c0392b;
            --bg-color: #f8f5fa;
            --card-bg: white;
            --text-color: #333;
            --border-color: #f0e0ff;
            --highlight-bg: #f5e9ff;
        }
        
        body.theme-green {
            --primary-color: #2ecc71;
            --primary-hover: #27ae60;
            --secondary-color: #3498db;
            --secondary-hover: #2980b9;
            --danger-color: #e74c3c;
            --danger-hover: #c0392b;
            --bg-color: #f5faf7;
            --card-bg: white;
            --text-color: #333;
            --border-color: #e0f5e0;
            --highlight-bg: #e9ffef;
        }
        
        body.theme-dark {
            --primary-color: #3498db;
            --primary-hover: #2980b9;
            --secondary-color: #2ecc71;
            --secondary-hover: #27ae60;
            --danger-color: #e74c3c;
            --danger-hover: #c0392b;
            --bg-color: #2c3e50;
            --card-bg: #34495e;
            --text-color: #ecf0f1;
            --border-color: #4a6278;
            --highlight-bg: #2d4257;
        }
        
        body.theme-dark-purple {
            --primary-color: #9b59b6;
            --primary-hover: #8e44ad;
            --secondary-color: #2ecc71;
            --secondary-hover: #27ae60;
            --danger-color: #e74c3c;
            --danger-hover: #c0392b;
            --bg-color: #2a2040;
            --card-bg: #382952;
            --text-color: #ecf0f1;
            --border-color: #4a3668;
            --highlight-bg: #33294d;
        }
        
        body.theme-dark-green {
            --primary-color: #2ecc71;
            --primary-hover: #27ae60;
            --secondary-color: #3498db;
            --secondary-hover: #2980b9;
            --danger-color: #e74c3c;
            --danger-hover: #c0392b;
            --bg-color: #1e352d;
            --card-bg: #2d4a3e;
            --text-color: #ecf0f1;
            --border-color: #355a4c;
            --highlight-bg: #2a4439;
        }
        
        body.theme-light {
            --primary-color: #3498db;
            --primary-hover: #2980b9;
            --secondary-color: #27ae60;
            --secondary-hover: #219653;
            --danger-color: #e74c3c;
            --danger-hover: #c0392b;
            --bg-color: #ffffff;
            --card-bg: #f9f9f9;
            --text-color: #333;
            --border-color: #e0e0e0;
            --highlight-bg: #f5f9fc;
        }
        
        /* Base styles */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--bg-color);
            transition: all 0.3s ease;
        }
        
        h1 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 30px;
        }
        
        h2 {
            color: var(--primary-color);
            margin-top: 0;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
        }
        
        /* Layout containers */
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        .form-section, 
        .preview-section {
            background-color: var(--card-bg);
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .preview-section {
            position: relative;
        }
        
        /* Form elements */
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-color);
        }
        
        input[type="text"], 
        textarea, 
        select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-family: inherit;
            font-size: 15px;
            box-sizing: border-box;
            background-color: var(--card-bg);
            color: var(--text-color);
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        select {
            padding: 10px;
            border-radius: 4px;
            border: 1px solid var(--border-color);
            font-size: 15px;
            margin-right: 10px;
            background-color: var(--card-bg);
            color: var(--text-color);
        }
        
        /* Buttons */
        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn:hover {
            background-color: var(--primary-hover);
        }
        
        .btn-copy {
            background-color: var(--secondary-color);
        }
        
        .btn-copy:hover {
            background-color: var(--secondary-hover);
        }
        
        .btn-reset {
            background-color: var(--danger-color);
        }
        
        .btn-reset:hover {
            background-color: var(--danger-hover);
        }
        
        .button-group {
            display: flex;
            margin-top: 20px;
            gap: 10px;
        }
        
        /* Conditional fields */
        .conditional-fields-container {
            padding: 15px;
            border-left: 3px solid var(--primary-color);
            margin-top: 5px;
            margin-bottom: 15px;
            background-color: var(--highlight-bg);
            border-radius: 0 4px 4px 0;
        }
        
        /* Special styling for dark mode conditional fields */
        body.theme-dark .conditional-fields-container,
        body.theme-dark-purple .conditional-fields-container,
        body.theme-dark-green .conditional-fields-container {
            background-color: #a8c9e6;
            border-color: #3498db;
        }
        
        body.theme-dark .conditional-fields-container label,
        body.theme-dark .conditional-fields-container input,
        body.theme-dark .conditional-fields-container textarea,
        body.theme-dark-purple .conditional-fields-container label,
        body.theme-dark-purple .conditional-fields-container input,
        body.theme-dark-purple .conditional-fields-container textarea,
        body.theme-dark-green .conditional-fields-container label,
        body.theme-dark-green .conditional-fields-container input,
        body.theme-dark-green .conditional-fields-container textarea {
            color: #333;
        }
        
        body.theme-dark .conditional-fields-container input,
        body.theme-dark .conditional-fields-container textarea,
        body.theme-dark-purple .conditional-fields-container input,
        body.theme-dark-purple .conditional-fields-container textarea,
        body.theme-dark-green .conditional-fields-container input,
        body.theme-dark-green .conditional-fields-container textarea {
            background-color: #ffffff;
            border-color: #ccc;
        }
        
        /* Additional parts */
        .additional-parts-wrapper {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px dashed var(--border-color);
        }
        
        .additional-part-group {
            border-left: 3px solid var(--primary-color);
            padding: 15px;
            margin-bottom: 30px;
            background-color: var(--highlight-bg);
            border-radius: 4px;
        }
        
        .add-more-link {
            color: var(--primary-color);
            cursor: pointer;
            font-weight: 600;
            display: inline-block;
            margin-top: 10px;
            margin-bottom: 20px;
            text-decoration: underline;
        }
        
        .add-more-link:hover {
            text-decoration: none;
        }
        
        .delete-group-btn {
            background-color: var(--danger-color);
            color: white;
            border: none;
            padding: 5px 10px;
            font-size: 14px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
            margin-bottom: 20px;
        }
        
        .delete-group-btn:hover {
            background-color: var(--danger-hover);
        }
        
        /* Preview section */
        #preview {
            background-color: var(--highlight-bg);
            padding: 20px;
            border-radius: 4px;
            border: 1px solid var(--border-color);
            min-height: 300px;
            white-space: pre-wrap;
            word-wrap: break-word;  /* ← Add this line */
            overflow-wrap: break-word;  /* ← Add this line */
            word-break: break-all;
            font-family: 'Segoe UI', Tahome, Geneva, Verdana, sans-serif;
            font-size: 14px;
            margin-top: 15px;
            overflow-y: auto;
            overflow-x: hidden;  /* ← Add this line to prevent horizontal scroll */
            line-height: 1.5;
            color: var(--text-color);
            max-width: 100%;
        }
        
        .copy-message {
            position: absolute;
            top: 25px;
            right: 25px;
            background-color: var(--secondary-color);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .copy-message.show {
            opacity: 1;
        }
        
        /* Template controls */
        .template-controls {
            margin-bottom: 30px;
        }
        
        /* Theme selector */
        .theme-selector {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
        }
        
        .theme-selector select {
            padding: 8px 12px;
            border-radius: 4px;
            background-color: var(--card-bg);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            cursor: pointer;
        }
        
        /* Responsive styles */
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }
            
            .theme-selector {
                position: static;
                margin-bottom: 20px;
                text-align: right;
            }
        }
    </style>
</head>
<body class="theme-blue">
    <!-- Theme selector -->
    <div class="theme-selector">
        <select id="theme-select" aria-label="Select color theme">
            <option value="blue">Light Blue</option>
            <option value="purple">Light Purple</option>
            <option value="green">Light Green</option>
            <option value="dark">Dark Mode Blue</option>
            <option value="dark-purple">Dark Mode Purple</option>
            <option value="dark-green">Dark Mode Green</option>
            <option value="light">Light Mode</option>
        </select>
    </div>

    <h1>Note Template Generator</h1>
    
    <div class="container">
        <div class="form-section">
            <h2>Template Input</h2>
            
            <div class="template-controls">
                <label for="template-select">Choose a template:</label>
                <select id="template-select">
                    <option value="breakfix">Break/Fix Task Notes</option>
                    <option value="network">Network Task Notes</option>
                    <option value="dbd">DBD Task Notes</option>
                    <option value="mobo">Motherboard Task Notes</option>
                    <option value="workwindow">Work Window Request Email</option>
                </select>
            </div>
            
            <form id="template-form">
                <!-- Fields will be dynamically generated here -->
            </form>
        </div>
        
        <div class="preview-section">
            <h2>Note Preview</h2>
            <div id="preview" role="region" aria-live="polite">Your compiled note will appear here...</div>
            <div class="button-group">
                <button type="button" class="btn btn-copy" id="copy-btn">Copy to Clipboard</button>
                <button type="button" class="btn btn-reset" id="reset-btn">Reset</button>
            </div>
            <div class="copy-message" id="copy-message" aria-hidden="true">Note copied to clipboard!</div>
        </div>
    </div>

    <script>
        // Template definitions
        const templates = {
            // Break/Fix Task Notes template
            breakfix: {
                title: "Break/Fix Task Notes",
                fields: [
                    { name: "taskId", label: "Task ID", type: "text" },
                    { name: "assetTagConfirmed", label: "Was the asset tag visually confirmed?", type: "select", options: ["Yes", "No"] },
                    { name: "uponArrival", label: "Upon Arrival:", type: "textarea" },
                    { name: "partReplaced", label: "Part(s) replaced?", type: "checkbox", hasConditionalFields: true },
                    { name: "oldSerialNumber", label: "Old Serial Number", type: "text", conditionalOn: { field: "partReplaced", value: "checked" } },
                    { name: "newSerialNumber", label: "New Serial Number", type: "text", conditionalOn: { field: "partReplaced", value: "checked" } },
                    { name: "licensePlate", label: "License Plate", type: "text", conditionalOn: { field: "partReplaced", value: "checked" } },
                    { name: "actionsTaken", label: "Actions Taken", type: "textarea" },
                    { name: "wasEscalated", label: "Was this ticket escalated?", type: "checkbox", hasConditionalFields: true },
                    { name: "escalatedTo", label: "Who was it escalated to?", type: "text", conditionalOn: { field: "wasEscalated", value: "checked" } },
                    { name: "seniorTechAlias", label: "Alias of the senior who approved this:", type: "text", conditionalOn: { field: "wasEscalated", value: "checked" } }
                ],
                format: (data) => {
                    let escalationInfo = "";
                    if (data.wasEscalated === "checked") {
                        escalationInfo = `

ESCALATION DETAILS:
- Escalated To: ${data.escalatedTo || "[Not specified]"}
- Senior Tech Approval: ${data.seniorTechAlias || "[Not specified]"}`;
                    }
                    
                    // Format part replacement information
                    let partReplacementInfo = "";
                    if (data.partReplaced === "checked") {
                        partReplacementInfo = `

PART(S) REPLACED: Yes
OLD SERIAL NUMBER: ${data.oldSerialNumber || "N/A"}
NEW SERIAL NUMBER: ${data.newSerialNumber || "N/A"}
LICENSE PLATE: ${data.licensePlate || "N/A"}`;
                    } else {
                        partReplacementInfo = "\nPART(S) REPLACED: No";
                    }
                    
                    return `TASK ID: ${data.taskId || "[No ID]"}
ASSET TAG CONFIRMED: ${data.assetTagConfirmed || "N/A"}

UPON ARRIVAL:
${data.uponArrival || "[No arrival notes recorded]"}${partReplacementInfo}

ACTIONS TAKEN:
${data.actionsTaken || "[No actions recorded]"}

TICKET ESCALATED: ${data.wasEscalated === "checked" ? "Yes" : "No"}${escalationInfo}`;
                }
            },
            
            // Network Task Notes template
            network: {
                title: "Network Task Notes",
                fields: [
                    { name: "taskId", label: "Task ID", type: "text" },
                    { name: "assetTagConfirmed", label: "Was the asset tag visually confirmed?", type: "select", options: ["Yes", "No"] },
                    { name: "uponArrival", label: "Upon Arrival:", type: "textarea" },
                    { name: "sourceDevice", label: "Source Device:Port", type: "text" },
                    { name: "endDevice", label: "End Device:Port", type: "text" },
                    { name: "partReplaced", label: "Part(s) replaced?", type: "checkbox", hasConditionalFields: true },
                    { name: "oldSerialNumber", label: "Old Serial Number", type: "text", conditionalOn: { field: "partReplaced", value: "checked" } },
                    { name: "newSerialNumber", label: "New Serial Number", type: "text", conditionalOn: { field: "partReplaced", value: "checked" } },
                    { name: "licensePlate", label: "License Plate", type: "text", conditionalOn: { field: "partReplaced", value: "checked" } },
                    { name: "actionsTaken", label: "Actions Taken", type: "textarea" },
                    { name: "wasEscalated", label: "Was this ticket escalated?", type: "checkbox", hasConditionalFields: true },
                    { name: "escalatedTo", label: "Who was it escalated to?", type: "text", conditionalOn: { field: "wasEscalated", value: "checked" } },
                    { name: "seniorTechAlias", label: "Alias of the senior who approved this:", type: "text", conditionalOn: { field: "wasEscalated", value: "checked" } }
                ],
                format: (data) => {
                    let escalationInfo = "";
                    if (data.wasEscalated === "checked") {
                        escalationInfo = `

ESCALATION DETAILS:
- Escalated To: ${data.escalatedTo || "[Not specified]"}
- Senior Tech Approval: ${data.seniorTechAlias || "[Not specified]"}`;
                    }
                    
                    // Format part replacement information
                    let partReplacementInfo = "";
                    if (data.partReplaced === "checked") {
                        partReplacementInfo = `

PART(S) REPLACED: Yes
OLD SERIAL NUMBER: ${data.oldSerialNumber || "N/A"}
NEW SERIAL NUMBER: ${data.newSerialNumber || "N/A"}
LICENSE PLATE: ${data.licensePlate || "N/A"}`;
                    } else {
                        partReplacementInfo = "\nPART(S) REPLACED: No";
                    }
                    
                    return `TASK ID: ${data.taskId || "[No ID]"}
ASSET TAG CONFIRMED: ${data.assetTagConfirmed || "N/A"}

UPON ARRIVAL:
${data.uponArrival || "[No arrival notes recorded]"}
SOURCE DEVICE:PORT: ${data.sourceDevice || "N/A"}
END DEVICE:PORT: ${data.endDevice || "N/A"}${partReplacementInfo}

ACTIONS TAKEN:
${data.actionsTaken || "[No actions recorded]"}

TICKET ESCALATED: ${data.wasEscalated === "checked" ? "Yes" : "No"}${escalationInfo}`;
                }
            },
            
            // DBD Task Notes template
            dbd: {
                title: "DBD Task Notes",
                fields: [
                    { name: "taskId", label: "Task ID", type: "text" },
                    { name: "assetTagConfirmed", label: "Was the asset tag visually confirmed?", type: "select", options: ["Yes", "No"] },
                    { name: "uponArrival", label: "Upon Arrival:", type: "textarea" },
                    { name: "partReplaced", label: "Part(s) replaced?", type: "checkbox", hasConditionalFields: true },
                    { name: "oldSerialNumber", label: "Old Serial Number", type: "text", conditionalOn: { field: "partReplaced", value: "checked" } },
                    { name: "newSerialNumber", label: "New Serial Number", type: "text", conditionalOn: { field: "partReplaced", value: "checked" } },
                    { name: "licensePlate", label: "License Plate", type: "text", conditionalOn: { field: "partReplaced", value: "checked" } },
                    { name: "driveLocation", label: "Location of drive being replaced", type: "text", conditionalOn: { field: "partReplaced", value: "checked" } },
                    { name: "binNumber", label: "Bin #", type: "text", conditionalOn: { field: "partReplaced", value: "checked" } },
                    { name: "properDiscard", label: "Was the drive discarded in the proper DBD bin?", type: "select", options: ["Yes", "No"], conditionalOn: { field: "partReplaced", value: "checked" } },
                    { name: "actionsTaken", label: "Actions Taken", type: "textarea" },
                    { name: "wasEscalated", label: "Was this ticket escalated?", type: "checkbox", hasConditionalFields: true },
                    { name: "escalatedTo", label: "Who was it escalated to?", type: "text", conditionalOn: { field: "wasEscalated", value: "checked" } },
                    { name: "seniorTechAlias", label: "Alias of the senior who approved this:", type: "text", conditionalOn: { field: "wasEscalated", value: "checked" } }
                ],
                format: (data) => {
                    let escalationInfo = "";
                    if (data.wasEscalated === "checked") {
                        escalationInfo = `

ESCALATION DETAILS:
- Escalated To: ${data.escalatedTo || "[Not specified]"}
- Senior Tech Approval: ${data.seniorTechAlias || "[Not specified]"}`;
                    }
                    
                    // Format part replacement information
                    let partReplacementInfo = "";
                    if (data.partReplaced === "checked") {
                        partReplacementInfo = `

PART(S) REPLACED: Yes
OLD SERIAL NUMBER: ${data.oldSerialNumber || "N/A"}
NEW SERIAL NUMBER: ${data.newSerialNumber || "N/A"}
LICENSE PLATE: ${data.licensePlate || "N/A"}
DRIVE LOCATION: ${data.driveLocation || "N/A"}
BIN #: ${data.binNumber || "N/A"}
DRIVE DISCARDED IN PROPER DBD BIN: ${data.properDiscard || "N/A"}`;
                    } else {
                        partReplacementInfo = "\nPART(S) REPLACED: No";
                    }
                    
                    return `TASK ID: ${data.taskId || "[No ID]"}
ASSET TAG CONFIRMED: ${data.assetTagConfirmed || "N/A"}

UPON ARRIVAL:
${data.uponArrival || "[No arrival notes recorded]"}${partReplacementInfo}

ACTIONS TAKEN:
${data.actionsTaken || "[No actions recorded]"}

TICKET ESCALATED: ${data.wasEscalated === "checked" ? "Yes" : "No"}${escalationInfo}`;
                }
            },

            // Motherboard Task Notes template
            mobo: {
                title: "Motherboard Task Notes",
                fields: [
                    { name: "taskId", label: "Task ID", type: "text" },
                    { name: "assetTagConfirmed", label: "Was the asset tag visually confirmed?", type: "select", options: ["Yes", "No"] },
                    { name: "uponArrival", label: "Upon Arrival:", type: "textarea" },
                    { name: "partReplaced", label: "Part(s) replaced?", type: "checkbox", hasConditionalFields: true },
                    { name: "oldSerialNumber", label: "Old Motherboard Serial Number", type: "text", conditionalOn: { field: "partReplaced", value: "checked" } },
                    { name: "newSerialNumber", label: "New Motherboard Serial Number", type: "text", conditionalOn: { field: "partReplaced", value: "checked" } },
                    { name: "licensePlate", label: "License Plate", type: "text", conditionalOn: { field: "partReplaced", value: "checked" } },
                    { name: "dbdMoved", label: "Were DBDs moved from old motherboard to new?", type: "checkbox", hasConditionalFields: true },
                    { name: "dbdSerialNumber", label: "DBD Serial Number", type: "text", conditionalOn: { field: "dbdMoved", value: "checked" } },
                    { name: "slotNumber", label: "Slot #", type: "text", conditionalOn: { field: "dbdMoved", value: "checked" } },
                    { name: "actionsTaken", label: "Actions Taken", type: "textarea" },
                    { name: "wasEscalated", label: "Was this ticket escalated?", type: "checkbox", hasConditionalFields: true },
                    { name: "escalatedTo", label: "Who was it escalated to?", type: "text", conditionalOn: { field: "wasEscalated", value: "checked" } },
                    { name: "seniorTechAlias", label: "Alias of the senior who approved this:", type: "text", conditionalOn: { field: "wasEscalated", value: "checked" } }
                ],
                format: (data) => {
                    let escalationInfo = "";
                    if (data.wasEscalated === "checked") {
                        escalationInfo = `

            ESCALATION DETAILS:
            - Escalated To: ${data.escalatedTo || "[Not specified]"}
            - Senior Tech Approval: ${data.seniorTechAlias || "[Not specified]"}`;
                    }
                    
                    // Format motherboard replacement information
                    let partReplacementInfo = "";
                    if (data.partReplaced === "checked") {
                        partReplacementInfo = `

PART(S) REPLACED: Yes
OLD MOTHERBOARD SERIAL NUMBER: ${data.oldSerialNumber || "N/A"}
NEW MOTHERBOARD SERIAL NUMBER: ${data.newSerialNumber || "N/A"}
LICENSE PLATE: ${data.licensePlate || "N/A"}`;
                    } else {
                        partReplacementInfo = "\nPART(S) REPLACED: No";
                    }

                    // Format DBD information
                    let dbdInfo = "";
                    if (data.dbdMoved === "checked") {
                        dbdInfo = `

DBD(S) MOVED FROM OLD TO NEW MOTHERBOARD: Yes
DBD SERIAL NUMBER: ${data.dbdSerialNumber || "N/A"}
SLOT #: ${data.slotNumber || "N/A"}`;
                    } else {
                        dbdInfo = "\nDBD(S) MOVED: No";
                    }
                    
                    return `TASK ID: ${data.taskId || "[No ID]"}
ASSET TAG CONFIRMED: ${data.assetTagConfirmed || "N/A"}

UPON ARRIVAL:
${data.uponArrival || "[No arrival notes recorded]"}
${partReplacementInfo}
${dbdInfo}

ACTIONS TAKEN:
${data.actionsTaken || "[No actions recorded]"}

TICKET ESCALATED: ${data.wasEscalated === "checked" ? "Yes" : "No"}${escalationInfo}`;
    }
},
            
            // Work Window Request Email template
            workwindow: {
                title: "Work Window Request Email",
                fields: [
                    { type: "info", text: `You can confirm availability for a specific dates via <a href="https://dccentral.microsoft.com/tasks/query/advanced/30704" target="_blank">SN-DCCentral</a> for SN or <a href="https://dccentral.microsoft.com/tasks/query/advanced/31722" target="_blank">SAT-DCCentral</a> for SAT. Our work window policy can be found <a href="https://microsoft.sharepoint.com/:w:/r/teams/dcops/reflib/_layouts/15/Doc.aspx?sourcedoc=%7B34AC5FCF-C562-4F64-922F-AD9AED915DEA%7D&file=Work%20Window%20Policy.docx&wdOrigin=TEAMS-MAGLEV.teams_ns.rwc&action=default&mobileredirect=true" target="_blank">here</a> for reference.`},
                    { name: "taskId", label: "Task ID", type: "text" },
                    { name: "date", label: "Suggested Date", type: "text" },
                    { name: "time", label: "Time of Availability", type: "text" },
                    { type: "info", text: `If a task is quarantined, please direct the requestor to <a href="https://microsoft.sharepoint.com/sites/COIPartnerResourceCenter/SitePages/CO+-Partner-Resource-Center.aspx?ct=1748876712863&or=Teams-HL&ga=1&LOF=1&xsdata=MDV8MDJ8fDdlZjg4MTg4OGJiMjQ0MzBhMTFjMDhkZTFhMTY3ODAwfDcyZjk4OGJmODZmMTQxYWY5MWFiMmQ3Y2QwMTFkYjQ3fDB8MHw2Mzg5NzY4ODA5MzgxMTkxMDB8VW5rbm93bnxWR1ZoYlhOVFpXTjFjbWwwZVZObGNuWnBZMlY4ZXlKRFFTSTZJbFJsWVcxelgwRlVVRk5sY25acFkyVmZVMUJQVEU5R0lpd2lWaUk2SWpBdU1DNHdNREF3SWl3aVVDSTZJbGRwYmpNeUlpd2lRVTRpT2lKUGRHaGxjaUlzSWxkVUlqb3hNWDA9fDF8TDJOb1lYUnpMekU1T21KaVpHTm1OalUzTWpZNFpqUXhNVGs1Tm1Nek5UZGxObU16TnpFeFptTTNRSFJvY21WaFpDNTJNaTl0WlhOellXZGxjeTh4TnpZeU1Ea3hNamt5T0Rnd3w4YTcwMGYyOTdiZDE0NzE0YzkwNDA4ZGUxYTE2NzdmZnxlNzQ5NGE4MjI3NjI0N2Q5OGYwMTNlNDI2ZWFiMmI5ZA%3D%3D&sdata=ZGtMSy9JZVhOYlRFRnFHV1M0MlFWc1pQbEp1OXArZWdoSnpBVGY0bDlUbz0%3D&ovuser=72f988bf-86f1-41af-91ab-2d7cd011db47%2Caguajardo%40microsoft.com&OR=Teams-HL&CT=1762904435825&clickparams=eyJBcHBOYW1lIjoiVGVhbXMtRGVza3RvcCIsIkFwcFZlcnNpb24iOiI0OS8yNTExMDYxMzYwMSIsIkhhc0ZlZGVyYXRlZFVzZXIiOmZhbHNlfQ%3D%3D" target="_blank">the CO&I Partner Resource Center</a> for further instructions on how to proceed with scheduling work windows for quarantined tasks.`}
                ],
                format: (data) => {
                    return `WORK WINDOW REQUEST - TASK ID: ${data.taskId || "TaskIdHolder"}

Hello,

We are writing to schedule a work window for Task #${data.taskId || "TaskIdHolder"}. We are available to begin a work window between 09:00 AM CST and 02:00 PM CST or 09:00 PM CST and 02:00 AM CST. Our next available window is available for ${data.date || "DATE"} at ${data.time || "TIME"}. Please confirm whether this time is acceptable for your team.

Important considerations:
• A minimum of 24 hours' notice is required for all work windows to ensure System Services can confirm availability and prepare accordingly.
• Prompt confirmation is essential. Delayed replies may result in the proposed time slot becoming unavailable, as our resources are limited and we cannot reserve slots indefinitely.
• Please ensure all necessary traffic is removed or rerouted prior to the work window start time to facilitate a timely and efficient completion of the requested work.

We appreciate your prompt attention to this matter.`;
                }
            }
        };

        // IDF/T2 Work Authorization template
            workAuth                                                                                                                                                                  : {
                title: "Work Authorization Request",
                fields: [
                    { name: "taskLink", label: "Task Link", type: "text" },
                    { name: "taskID", label: "Task ID", type: "text" },
                    { name: "startDevice", label: "Starting Device", type: "text" },
                    { name: "startPort", label: "Start Port", type: "text" },
                    { name: "expectedHop", label: "Expected Hop (leave empty if unknown)", type: "text" },
                    { name: "endDevice", label: "End Device", type: "text" },
                    { name: "endPort", label: "End Port", type: "text" },
                    { name: "actions", label: "Actions being taken", type: "text" },
                    { name: "assetTagConfirmed", label: "Was the asset tag visually confirmed?", type: "select", options: ["Yes", "No"] },
                    { name: "labelConfirmed", label: "Was the cable label visually confirmed?", type: "select", options: ["Yes", "No"] },
                    { name: "secondTech", label: "Alias of Second Tech QC", type: "text" },
                    { type: "info", text: `If a task is quarantined, please direct the requestor to <a href="https://microsoft.sharepoint.com/sites/COIPartnerResourceCenter/SitePages/CO+-Partner-Resource-Center.aspx?ct=1748876712863&or=Teams-HL&ga=1&LOF=1&xsdata=MDV8MDJ8fDdlZjg4MTg4OGJiMjQ0MzBhMTFjMDhkZTFhMTY3ODAwfDcyZjk4OGJmODZmMTQxYWY5MWFiMmQ3Y2QwMTFkYjQ3fDB8MHw2Mzg5NzY4ODA5MzgxMTkxMDB8VW5rbm93bnxWR1ZoYlhOVFpXTjFjbWwwZVZObGNuWnBZMlY4ZXlKRFFTSTZJbFJsWVcxelgwRlVVRk5sY25acFkyVmZVMUJQVEU5R0lpd2lWaUk2SWpBdU1DNHdNREF3SWl3aVVDSTZJbGRwYmpNeUlpd2lRVTRpT2lKUGRHaGxjaUlzSWxkVUlqb3hNWDA9fDF8TDJOb1lYUnpMekU1T21KaVpHTm1OalUzTWpZNFpqUXhNVGs1Tm1Nek5UZGxObU16TnpFeFptTTNRSFJvY21WaFpDNTJNaTl0WlhOellXZGxjeTh4TnpZeU1Ea3hNamt5T0Rnd3w4YTcwMGYyOTdiZDE0NzE0YzkwNDA4ZGUxYTE2NzdmZnxlNzQ5NGE4MjI3NjI0N2Q5OGYwMTNlNDI2ZWFiMmI5ZA%3D%3D&sdata=ZGtMSy9JZVhOYlRFRnFHV1M0MlFWc1pQbEp1OXArZWdoSnpBVGY0bDlUbz0%3D&ovuser=72f988bf-86f1-41af-91ab-2d7cd011db47%2Caguajardo%40microsoft.com&OR=Teams-HL&CT=1762904435825&clickparams=eyJBcHBOYW1lIjoiVGVhbXMtRGVza3RvcCIsIkFwcFZlcnNpb24iOiI0OS8yNTExMDYxMzYwMSIsIkhhc0ZlZGVyYXRlZFVzZXIiOmZhbHNlfQ%3D%3D" target="_blank">the CO&I Partner Resource Center</a> for further instructions on how to proceed with scheduling work windows for quarantined tasks.`}
                ],
                format: (data) => {
                    return ` - Approval Request - 
${data.taskId || "TaskIdHolder"}
Task Link: ${data.taskLink || "taskLink"}
Task ID: ${data.taskID || "taskID"}
Start Device: ${data.startDevice || "startDevice:port"}:${data.startPort}
Expected Hop: ${data.expectedHop || "expectedHop"}
End Device: ${data.endDevice || "endDevice:port"}:${data.endPort}
Required Actions: ${data.actions || "actions"}
Asset Tag Confirmed: ${data.actions || "Confirmed?"}
Cable Label Verified: ${data.actions || "Label?"}
2nd Tech QC Alias: ${data.secondTech || "secondTech"}`;
                }
            }
        };

        // Current template and parts counter
        let currentTemplate = 'breakfix';
        let additionalPartsCounter = 0;
        let additionalDBDsCounter = 0;
        
        // DOM elements
        const templateForm = document.getElementById('template-form');
        const previewDiv = document.getElementById('preview');
        const templateSelect = document.getElementById('template-select');
        const copyBtn = document.getElementById('copy-btn');
        const resetBtn = document.getElementById('reset-btn');
        const copyMessage = document.getElementById('copy-message');
        
        // Initialize with the default template
        generateFormFields();
        
        // Add event listeners
        templateSelect.addEventListener('change', changeTemplate);
        copyBtn.addEventListener('click', copyToClipboard);
        resetBtn.addEventListener('click', resetForm);
        
        // Theme selector event listener
        const themeSelect = document.getElementById('theme-select');
        themeSelect.addEventListener('change', function() {
            const selectedTheme = this.value;
            setTheme(selectedTheme);
        });
        
        // Function to set the theme
        function setTheme(theme) {
            // Remove all theme classes
            document.body.classList.remove('theme-blue', 'theme-purple', 'theme-green', 'theme-dark', 'theme-dark-purple', 'theme-dark-green','theme-light');
            // Add the selected theme class
            document.body.classList.add(`theme-${theme}`);
            
            // Save the theme preference to localStorage
            localStorage.setItem('preferredTheme', theme);
        }
        
        // Load saved theme preference if it exists
        const savedTheme = localStorage.getItem('preferredTheme');
        if (savedTheme) {
            themeSelect.value = savedTheme;
            setTheme(savedTheme);
        }
        
        // Function to change template
        function changeTemplate() {
            currentTemplate = templateSelect.value;
            generateFormFields();
            updatePreview();
        }
        
        // Function to generate form fields based on selected template
        function generateFormFields() {
            templateForm.innerHTML = '';
            additionalPartsCounter = 0;
            additionalDBDsCounter = 0;
            
            const template = templates[currentTemplate];
            
            // First pass: Create all regular fields (non-conditional)
            template.fields.forEach(field => {
                // Skip conditional fields - we'll add them after their parent field
                if (field.conditionalOn) {
                    return;
                }
                
                // Handle info/text-only fields
                if (field.type === 'info') {
                    const infoDiv = document.createElement('div');
                    infoDiv.style.padding = '12px';
                    infoDiv.style.margin = '15px 0';
                    infoDiv.style.backgroundColor = 'var(--highlight-bg)';
                    infoDiv.style.borderLeft = '3px solid var(--primary-color)';
                    infoDiv.style.borderRadius = '4px';
                    infoDiv.style.fontSize = '14px';
                    infoDiv.style.lineHeight = '1.5';
                    infoDiv.style.color = 'var(--text-color)';
                    
                    // Check if text contains HTML
                    if (field.text && field.text.includes('<')) {
                        infoDiv.innerHTML = field.text;
                    } else {
                        infoDiv.textContent = field.text || field.label;
                    }
                    
                    templateForm.appendChild(infoDiv);
                    return;
                }
                
                const formGroup = document.createElement('div');
                formGroup.className = 'form-group';
                
                const label = document.createElement('label');
                label.setAttribute('for', field.name);
                // Check if label contains HTML (like links)
                if (field.label.includes('<')) {
                    label.innerHTML = field.label;
                } else {
                    label.textContent = field.label;
                }
                
                // Create the input based on field type
                let input;
                if (field.type === 'textarea') {
                    input = document.createElement('textarea');
                } else if (field.type === 'select' && field.options) {
                    input = document.createElement('select');
                    // Add an empty option first
                    const emptyOption = document.createElement('option');
                    emptyOption.value = '';
                    emptyOption.textContent = '-- Select --';
                    input.appendChild(emptyOption);
                    
                    // Add the rest of the options
                    field.options.forEach(optionText => {
                        const option = document.createElement('option');
                        option.value = optionText;
                        option.textContent = optionText;
                        input.appendChild(option);
                    });
                } else if (field.type === 'checkbox') {
                    input = document.createElement('input');
                    input.type = 'checkbox';
                    input.style.marginLeft = '0';
                    input.style.marginTop = '10px';
                } else {
                    input = document.createElement('input');
                    input.type = field.type;
                }
                
                input.id = field.name;
                input.name = field.name;
                
                // Add event listeners
                if (field.type === 'checkbox' && field.hasConditionalFields) {
                    input.addEventListener('change', function() {
                        updateConditionalFieldsVisibility(this);
                        updatePreview();
                    });
                } else if (field.type === 'select' && field.hasConditionalFields) {
                    input.addEventListener('change', handleConditionalFields);
                } else {
                    input.addEventListener('input', updatePreview);
                }
                
                formGroup.appendChild(label);
                formGroup.appendChild(input);
                templateForm.appendChild(formGroup);
                
                // If this field has conditional fields, add them right after it
                if (field.hasConditionalFields) {
                    addConditionalFieldsForParent(field.name, template);
                }
            });
        }

        // New helper function to add conditional fields recursively
        function addConditionalFieldsForParent(parentFieldName, template) {
            // Find all conditional fields that depend on this parent field
            const conditionalFields = template.fields.filter(f => 
                f.conditionalOn && f.conditionalOn.field === parentFieldName
            );
            
            if (conditionalFields.length === 0) return;
            
            // Create a container for the conditional fields
            const conditionalContainer = document.createElement('div');
            conditionalContainer.id = `conditional-container-${parentFieldName}`;
            conditionalContainer.className = 'conditional-fields-container';
            conditionalContainer.style.display = 'none';
            
            // Add each conditional field to the container
            conditionalFields.forEach(condField => {
                // Handle info/text-only conditional fields
                if (condField.type === 'info') {
                    const infoDiv = document.createElement('div');
                    infoDiv.style.padding = '12px';
                    infoDiv.style.margin = '10px 0';
                    infoDiv.style.backgroundColor = '#f9f9f9';
                    infoDiv.style.borderLeft = '3px solid var(--primary-color)';
                    infoDiv.style.borderRadius = '4px';
                    infoDiv.style.fontSize = '14px';
                    infoDiv.style.lineHeight = '1.5';
                    infoDiv.style.color = 'var(--text-color)';
                    
                    // Check if text contains HTML
                    if (condField.text && condField.text.includes('<')) {
                        infoDiv.innerHTML = condField.text;
                    } else {
                        infoDiv.textContent = condField.text || condField.label;
                    }
                    
                    conditionalContainer.appendChild(infoDiv);
                    return;
                }
                
                const condFormGroup = document.createElement('div');
                condFormGroup.className = 'form-group';
                
                const condLabel = document.createElement('label');
                condLabel.setAttribute('for', condField.name);
                // Check if label contains HTML (like links)
                if (condField.label.includes('<')) {
                    condLabel.innerHTML = condField.label;
                } else {
                    condLabel.textContent = condField.label;
                }
                
                let condInput;
                if (condField.type === 'textarea') {
                    condInput = document.createElement('textarea');
                } else if (condField.type === 'select' && condField.options) {
                    condInput = document.createElement('select');
                    // Add an empty option first
                    const emptyOption = document.createElement('option');
                    emptyOption.value = '';
                    emptyOption.textContent = '-- Select --';
                    condInput.appendChild(emptyOption);
                    
                    // Add the rest of the options
                    condField.options.forEach(optionText => {
                        const option = document.createElement('option');
                        option.value = optionText;
                        option.textContent = optionText;
                        condInput.appendChild(option);
                    });
                } else if (condField.type === 'checkbox') {
                    condInput = document.createElement('input');
                    condInput.type = 'checkbox';
                    condInput.style.marginLeft = '0';
                    condInput.style.marginTop = '10px';
                    
                } else {
                    condInput = document.createElement('input');
                    condInput.type = condField.type;
                    condInput.addEventListener('input', updatePreview);
                }
                
                condInput.id = condField.name;
                condInput.name = condField.name;
                
                condFormGroup.appendChild(condLabel);
                condFormGroup.appendChild(condInput);
                conditionalContainer.appendChild(condFormGroup);
                
            });
            
            // Add the conditional container to the form
            templateForm.appendChild(conditionalContainer);
            
            // Add "Add More Parts" functionality for part replacement sections
            if (parentFieldName === 'partReplaced' && ['breakfix', 'dbd', 'network', 'mobo'].includes(currentTemplate)) {
                // Create wrapper for additional parts
                const additionalPartsWrapper = document.createElement('div');
                additionalPartsWrapper.className = 'additional-parts-wrapper';
                
                // Create container for additional parts
                const additionalPartsContainer = document.createElement('div');
                additionalPartsContainer.id = 'additional-parts-container';
                additionalPartsWrapper.appendChild(additionalPartsContainer);
                
                // Add the "Add More Parts" link
                const addMoreContainer = document.createElement('div');
                addMoreContainer.id = 'add-more-container';
                
                const addMoreLink = document.createElement('div');
                addMoreLink.className = 'add-more-link';
                addMoreLink.textContent = '+ Add More Parts';
                addMoreLink.addEventListener('click', addMoreParts);
                
                addMoreContainer.appendChild(addMoreLink);
                additionalPartsWrapper.appendChild(addMoreContainer);
                
                // Add the wrapper to the conditional container
                conditionalContainer.appendChild(additionalPartsWrapper);
            }

            // Add "Add More DBDs" for motherboard template
            if (parentFieldName === 'dbdMoved' && currentTemplate === 'mobo') {
                const additionalDBDsWrapper = document.createElement('div');
                additionalDBDsWrapper.className = 'additional-parts-wrapper';
                
                const additionalDBDsContainer = document.createElement('div');
                additionalDBDsContainer.id = 'additional-dbds-container';
                additionalDBDsWrapper.appendChild(additionalDBDsContainer);
                
                const addMoreDBDContainer = document.createElement('div');
                addMoreDBDContainer.id = 'add-more-dbd-container';
                
                const addMoreDBDLink = document.createElement('div');
                addMoreDBDLink.className = 'add-more-link';
                addMoreDBDLink.textContent = '+ Add More DBDs';
                addMoreDBDLink.addEventListener('click', addMoreDBDs);
                
                addMoreDBDContainer.appendChild(addMoreDBDLink);
                additionalDBDsWrapper.appendChild(addMoreDBDContainer);

                conditionalContainer.appendChild(additionalDBDsWrapper);
            }
        }

        
        // Function to update visibility of conditional fields based on checkbox state
        function updateConditionalFieldsVisibility(checkbox) {
            const container = document.getElementById(`conditional-container-${checkbox.id}`);
            if (container) {
                if (checkbox.checked) {
                    container.style.display = 'block';
                } else {
                    container.style.display = 'none';
                    // Clear all input fields in the container
                    const inputs = container.querySelectorAll('input, textarea, select');
                    inputs.forEach(input => {
                        if (input.type === 'checkbox') {
                            input.checked = false;
                        } else {
                            input.value = '';
                        }
                    });
                    
                    // If this is the partReplaced checkbox, also reset additional parts
                    if (checkbox.id === 'partReplaced') {
                        resetAdditionalParts();
                    }
                    
                    // If this is the dbdMoved checkbox, also reset additional DBDs
                    if (checkbox.id === 'dbdMoved') {
                        resetAdditionalDBDs();
                    }
                }
            }
        }
        
        // Function to reset additional parts
        function resetAdditionalParts() {
            const additionalPartsContainer = document.getElementById('additional-parts-container');
            if (additionalPartsContainer) {
                additionalPartsContainer.innerHTML = '';
            }
            additionalPartsCounter = 0;
        }
        
        // Function to reset additional DBDs
        function resetAdditionalDBDs() {
            const additionalDBDsContainer = document.getElementById('additional-dbds-container');
            if (additionalDBDsContainer) {
                additionalDBDsContainer.innerHTML = '';
            }
            additionalDBDsCounter = 0;
        }
        
        // Function to handle showing/hiding conditional fields
        function handleConditionalFields(event) {
            const triggerField = event.target;
            const triggerValue = triggerField.value;
            const conditionalFields = document.querySelectorAll(`.conditional-field[data-depends-on="${triggerField.id}"]`);
            
            conditionalFields.forEach(field => {
                const requiredValue = field.getAttribute('data-depends-value');
                if (triggerValue === requiredValue) {
                    field.style.display = 'block';
                } else {
                    field.style.display = 'none';
                    // Clear values in hidden fields
                    const inputs = field.querySelectorAll('input, textarea, select');
                    inputs.forEach(input => input.value = '');
                }
            });
            
            updatePreview();
        }
        
        // Function to add more parts
        function addMoreParts() {
            additionalPartsCounter++;
            const container = document.getElementById('additional-parts-container');
            
            const partGroup = document.createElement('div');
            partGroup.className = 'additional-part-group';
            partGroup.id = `additional-part-${additionalPartsCounter}`;
            
            // Create a heading
            const heading = document.createElement('h4');
            heading.textContent = `Additional Part ${additionalPartsCounter}`;
            heading.style.marginTop = '0';
            partGroup.appendChild(heading);
            
            // Create common fields for all templates
                if (currentTemplate === 'mobo') {
                    createFormField(partGroup, 'Old Motherboard Serial Number', `oldSerialNumber${additionalPartsCounter}`, 'text');
                    createFormField(partGroup, 'New Motherboard Serial Number', `newSerialNumber${additionalPartsCounter}`, 'text');
                    createFormField(partGroup, 'License Plate', `licensePlate${additionalPartsCounter}`, 'text');
                } else {
                    createFormField(partGroup, 'Old Serial Number', `oldSerialNumber${additionalPartsCounter}`, 'text');
                    createFormField(partGroup, 'New Serial Number', `newSerialNumber${additionalPartsCounter}`, 'text');
                    createFormField(partGroup, 'License Plate', `licensePlate${additionalPartsCounter}`, 'text');
                }

                // Add DBD-specific fields
                if (currentTemplate === 'dbd') {
                createFormField(partGroup, 'Location of drive being replaced', `driveLocation${additionalPartsCounter}`, 'text');
                createFormField(partGroup, 'Bin #', `binNumber${additionalPartsCounter}`, 'text');
                
                // Add select field for proper discard
                const properDiscardGroup = document.createElement('div');
                properDiscardGroup.className = 'form-group';
                
                const properDiscardLabel = document.createElement('label');
                properDiscardLabel.setAttribute('for', `properDiscard${additionalPartsCounter}`);
                properDiscardLabel.textContent = 'Was the drive discarded in the proper DBD bin?';
                
                const properDiscardInput = document.createElement('select');
                properDiscardInput.id = `properDiscard${additionalPartsCounter}`;
                properDiscardInput.name = `properDiscard${additionalPartsCounter}`;
                
                // Add options
                const emptyOption = document.createElement('option');
                emptyOption.value = '';
                emptyOption.textContent = '-- Select --';
                properDiscardInput.appendChild(emptyOption);
                
                ["Yes", "No"].forEach(optionText => {
                    const option = document.createElement('option');
                    option.value = optionText;
                    option.textContent = optionText;
                    properDiscardInput.appendChild(option);
                });
                
                properDiscardInput.addEventListener('input', updatePreview);
                
                properDiscardGroup.appendChild(properDiscardLabel);
                properDiscardGroup.appendChild(properDiscardInput);
                partGroup.appendChild(properDiscardGroup);
            }
            
            // Add Delete button
            const deleteButton = document.createElement('button');
            deleteButton.className = 'delete-group-btn';
            deleteButton.textContent = 'Delete this part';
            deleteButton.setAttribute('type', 'button');
            deleteButton.setAttribute('data-part-id', additionalPartsCounter);
            deleteButton.onclick = function() {
                deletePartGroup(this.getAttribute('data-part-id'));
            };
            
            partGroup.appendChild(deleteButton);
            container.appendChild(partGroup);
            
            updatePreview();
        }
        
        // Function to add more DBDs (for motherboard template)
        function addMoreDBDs() {
            additionalDBDsCounter++;
            const container = document.getElementById('additional-dbds-container');
            
            const dbdGroup = document.createElement('div');
            dbdGroup.className = 'additional-part-group';
            dbdGroup.id = `additional-dbd-${additionalDBDsCounter}`;
            
            // Create a heading
            const heading = document.createElement('h4');
            heading.textContent = `Additional DBD ${additionalDBDsCounter}`;
            heading.style.marginTop = '0';
            dbdGroup.appendChild(heading);
            
            // Create DBD-specific fields
            createFormField(dbdGroup, 'DBD Serial Number', `dbdSerialNumber${additionalDBDsCounter}`, 'text');
            createFormField(dbdGroup, 'Slot #', `slotNumber${additionalDBDsCounter}`, 'text');
            
            // Add Delete button
            const deleteButton = document.createElement('button');
            deleteButton.className = 'delete-group-btn';
            deleteButton.textContent = 'Delete this DBD';
            deleteButton.setAttribute('type', 'button');
            deleteButton.setAttribute('data-dbd-id', additionalDBDsCounter);
            deleteButton.onclick = function() {
                deleteDBDGroup(this.getAttribute('data-dbd-id'));
            };
            
            dbdGroup.appendChild(deleteButton);
            container.appendChild(dbdGroup);
            
            updatePreview();
        }
        
        // Helper function to create form fields
        function createFormField(parent, labelText, fieldId, fieldType) {
            const group = document.createElement('div');
            group.className = 'form-group';
            
            const label = document.createElement('label');
            label.setAttribute('for', fieldId);
            label.textContent = labelText;
            
            const input = document.createElement('input');
            input.type = fieldType;
            input.id = fieldId;
            input.name = fieldId;
            input.addEventListener('input', updatePreview);
            
            group.appendChild(label);
            group.appendChild(input);
            parent.appendChild(group);
        }
        
        // Function to delete a part group
        function deletePartGroup(partId) {
            partId = String(partId);
            
            const partGroup = document.getElementById(`additional-part-${partId}`);
            if (partGroup) {
                partGroup.remove();
                updatePreview();
            }
        }
        
        // Function to delete a DBD group
        function deleteDBDGroup(dbdId) {
            dbdId = String(dbdId);
            
            const dbdGroup = document.getElementById(`additional-dbd-${dbdId}`);
            if (dbdGroup) {
                dbdGroup.remove();
                updatePreview();
            }
        }
        
        // Function to update preview as user types
        function updatePreview() {
            const formData = {};
            const template = templates[currentTemplate];
            
            // Collect values from regular fields
            template.fields.forEach(field => {
                const input = document.getElementById(field.name);
                if (input) {
                    // Handle checkbox values differently
                    if (field.type === 'checkbox') {
                        formData[field.name] = input.checked ? "checked" : "";
                    } else {
                        formData[field.name] = input.value;
                    }
                }
            });
            
            // Collect values from additional parts
            if (['breakfix', 'dbd', 'network', 'mobo'].includes(currentTemplate)) {
                formData.additionalParts = [];
                
                // Look for all additional parts in the DOM
                for (let i = 1; i <= additionalPartsCounter; i++) {
                    const partGroup = document.getElementById(`additional-part-${i}`);
                    if (partGroup) {
                        const oldSerial = document.getElementById(`oldSerialNumber${i}`);
                        const newSerial = document.getElementById(`newSerialNumber${i}`);
                        const licensePlate = document.getElementById(`licensePlate${i}`);
                        
                        if (oldSerial && newSerial && licensePlate) {
                            const partData = {
                                id: i,
                                oldSerialNumber: oldSerial.value,
                                newSerialNumber: newSerial.value,
                                licensePlate: licensePlate.value
                            };
                            
                            // Add DBD-specific fields
                            if (currentTemplate === 'dbd') {
                                const driveLocation = document.getElementById(`driveLocation${i}`);
                                const binNumber = document.getElementById(`binNumber${i}`);
                                const properDiscard = document.getElementById(`properDiscard${i}`);
                                
                                if (driveLocation) partData.driveLocation = driveLocation.value;
                                if (binNumber) partData.binNumber = binNumber.value;
                                if (properDiscard) partData.properDiscard = properDiscard.value;
                            }
                            
                            formData.additionalParts.push(partData);
                        }
                    }
                }
            }
            
            // Collect values from additional DBDs (for motherboard template)
            if (currentTemplate === 'mobo') {
                formData.additionalDBDs = [];
                
                // Look for all additional DBDs in the DOM
                for (let i = 1; i <= additionalDBDsCounter; i++) {
                    const dbdGroup = document.getElementById(`additional-dbd-${i}`);
                    if (dbdGroup) {
                        const dbdSerial = document.getElementById(`dbdSerialNumber${i}`);
                        const slotNum = document.getElementById(`slotNumber${i}`);
                        
                        if (dbdSerial && slotNum) {
                            formData.additionalDBDs.push({
                                id: i,
                                dbdSerialNumber: dbdSerial.value,
                                slotNumber: slotNum.value
                            });
                        }
                    }
                }
            }
            
            // Format the note
            let formattedNote = template.format(formData);
            
            // Add additional parts info to the formatted note
            if (['breakfix', 'dbd', 'network', 'mobo'].includes(currentTemplate) && 
                formData.additionalParts && 
                formData.additionalParts.length > 0) {
                
                formattedNote += '\n\nADDITIONAL PARTS:';
                
                formData.additionalParts.forEach((part, index) => {
                    let additionalPartText = `\n\nPART #${index + 2}:
OLD SERIAL NUMBER: ${part.oldSerialNumber || "N/A"}
NEW SERIAL NUMBER: ${part.newSerialNumber || "N/A"}
LICENSE PLATE: ${part.licensePlate || "N/A"}`;
                    
                    // Add DBD-specific fields
                    if (currentTemplate === 'dbd') {
                        if (part.driveLocation !== undefined) {
                            additionalPartText += `\nDRIVE LOCATION: ${part.driveLocation || "N/A"}`;
                        }
                        if (part.binNumber !== undefined) {
                            additionalPartText += `\nBIN #: ${part.binNumber || "N/A"}`;
                        }
                        if (part.properDiscard !== undefined) {
                            additionalPartText += `\nDRIVE DISCARDED IN PROPER DBD BIN: ${part.properDiscard || "N/A"}`;
                        }
                    }
                    
                    formattedNote += additionalPartText;
                });
            }
            
            // Add additional DBDs info to the formatted note (for motherboard)
            if (currentTemplate === 'mobo' && 
                formData.additionalDBDs && 
                formData.additionalDBDs.length > 0) {
                
                formattedNote += '\n\nADDITIONAL DBDs:';
                
                formData.additionalDBDs.forEach((dbd, index) => {
                    let additionalDBDText = `\n\nDBD #${index + 2}:
DBD SERIAL NUMBER: ${dbd.dbdSerialNumber || "N/A"}
SLOT #: ${dbd.slotNumber || "N/A"}`;
                    
                    formattedNote += additionalDBDText;
                });
            }
            
            previewDiv.textContent = formattedNote;
        }
        
        // Function to copy to clipboard
        function copyToClipboard() {
            const noteText = previewDiv.textContent;
            
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(noteText)
                    .then(() => showCopyMessage())
                    .catch(() => fallbackCopyTextToClipboard(noteText));
            } else {
                fallbackCopyTextToClipboard(noteText);
            }
        }
        
        // Show copy success message
        function showCopyMessage() {
            copyMessage.classList.add('show');
            setTimeout(() => {
                copyMessage.classList.remove('show');
            }, 2000);
        }
        
        // Fallback copy function for older browsers
        function fallbackCopyTextToClipboard(text) {
            try {
                const textArea = document.createElement("textarea");
                textArea.value = text;
                
                // Position offscreen
                textArea.style.position = "fixed";
                textArea.style.left = "-999999px";
                textArea.style.top = "-999999px";
                document.body.appendChild(textArea);
                
                textArea.focus();
                textArea.select();
                
                const successful = document.execCommand('copy');
                document.body.removeChild(textArea);
                
                if (successful) {
                    showCopyMessage();
                } else {
                    console.error('Fallback: Could not copy text');
                    alert('Could not copy text. Please select the text manually.');
                }
            } catch (err) {
                console.error('Fallback: Could not copy text', err);
                alert('Could not copy text. Please select the text manually.');
            }
        }
        
        // Reset form function
        function resetForm() {
            templateForm.reset();
            
            // Reset conditional field containers
            document.querySelectorAll('.conditional-fields-container').forEach(container => {
                container.style.display = 'none';
            });
            
            // Reset checkboxes (they might not be properly reset by the form.reset())
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = false;
            });
            
            // Reset additional parts
            resetAdditionalParts();
            
            // Reset additional DBDs
            resetAdditionalDBDs();
            
            updatePreview();
        }
    </script>
</body>
</html>
