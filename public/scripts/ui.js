function Xj(j,z={}){let{topRight:Q=!0,bottomLeft:J=!0}=z;if(j.querySelectorAll(".glow-effect").forEach((Y)=>Y.remove()),Q){let Y=document.createElement("span");Y.className="glow-effect glow-effect--shine",j.appendChild(Y);let $=document.createElement("span");$.className="glow-effect glow-effect--glow",j.appendChild($);let W=document.createElement("span");W.className="glow-effect glow-effect--glow glow-effect--glow-bright",j.appendChild(W)}if(J){let Y=document.createElement("span");Y.className="glow-effect glow-effect--shine glow-effect--bottom",j.appendChild(Y);let $=document.createElement("span");$.className="glow-effect glow-effect--glow glow-effect--bottom",j.appendChild($);let W=document.createElement("span");W.className="glow-effect glow-effect--glow glow-effect--glow-bright glow-effect--bottom",j.appendChild(W)}}function Yj(){document.querySelectorAll(".btn").forEach((j)=>{Xj(j)})}function Zj(j){let z=document.querySelector(j);if(!z)return;let Q=z.querySelector(".custom-select-trigger"),J=z.querySelector(".custom-select-dropdown"),Y=z.querySelectorAll(".custom-select-option"),$=z.querySelector(".select-value"),W=z.querySelector("select");Q.addEventListener("click",(X)=>{X.stopPropagation();let Z=z.classList.contains("open");if(p(),!Z)z.classList.add("open"),Q.setAttribute("aria-expanded","true")}),Y.forEach((X)=>{X.addEventListener("click",()=>{let Z=X.getAttribute("data-value"),q=X.textContent;if($.textContent=q,W)W.value=Z,W.dispatchEvent(new Event("change"));Y.forEach((G)=>{G.classList.remove("selected"),G.setAttribute("aria-selected","false")}),X.classList.add("selected"),X.setAttribute("aria-selected","true"),z.classList.remove("open"),Q.setAttribute("aria-expanded","false")})}),Q.addEventListener("keydown",(X)=>{if(X.key==="Enter"||X.key===" ")X.preventDefault(),Q.click();else if(X.key==="Escape")z.classList.remove("open"),Q.setAttribute("aria-expanded","false")})}function p(){document.querySelectorAll(".custom-select.open").forEach((j)=>{j.classList.remove("open"),j.querySelector(".custom-select-trigger")?.setAttribute("aria-expanded","false")})}document.addEventListener("click",p);var M="checked",K="N/A",T="[Not specified]";function _(j){return j===M?"Yes":"No"}function C(j,z=6){if(!j||j===K||j===T)return j;return j.length>z?"..."+j.slice(-z):j}function $j(j,z){if(!j||j.length===0)return"";let Q=`

REPLACED PARTS (${j.length}):`;return j.forEach((J)=>{let Y=C(J.oldSerialNumber||K),$=C(J.newSerialNumber||K),W=J.licensePlate||K,X=`
• ${Y} → ${$} (LP: ${W})`;if(z==="dbd"){let Z=J.driveLocation||K,q=J.binNumber||K;X+=` | Loc: ${Z}, Bin: ${q}`}Q+=X}),Q}function qj(j){if(!j||j.length===0)return"";let z=`

MOVED DBDs (${j.length}):`;return j.forEach((Q)=>{let J=C(Q.dbdSerialNumber||K),Y=Q.slotNumber||K;z+=`
• ${J} (Slot: ${Y})`}),z}function F(j){if(j.wasEscalated===M)return`

ESCALATION DETAILS:
- Escalated To: ${j.escalatedTo||T}
- Senior Tech Approval: ${j.seniorTechAlias||T}`;return""}function r(j){let z;if(j.type==="textarea")z=document.createElement("textarea");else if(j.type==="select"&&j.options){z=document.createElement("select");let Q=document.createElement("option");Q.value="",Q.textContent="-- Select --",z.appendChild(Q),j.options.forEach((J)=>{let Y=document.createElement("option");Y.value=J,Y.textContent=J,z.appendChild(Y)})}else if(j.type==="checkbox")z=document.createElement("input"),z.type="checkbox";else z=document.createElement("input"),z.type=j.type;if(j.name)z.id=j.name,z.name=j.name;return z}function c(j){let z=document.createElement("div");if(z.style.padding="12px",z.style.backgroundColor="var(--highlight-bg)",z.style.borderLeft="3px solid var(--primary-color)",z.style.borderRadius="4px",z.style.fontSize="14px",z.style.lineHeight="1.5",z.style.color="var(--text-color)",z.style.overflowWrap="break-word",z.style.wordBreak="break-word",j&&j.includes("<"))z.innerHTML=j;else z.textContent=j;return z}var P=[{name:"taskId",label:"Task ID",type:"text"},{name:"assetTagConfirmed",label:"Was the asset tag visually confirmed?",type:"checkbox"},{name:"uponArrival",label:"Upon Arrival:",type:"textarea"}],E=[{name:"partReplaced",label:"Part(s) replaced?",type:"checkbox",hasConditionalFields:!0},{name:"oldSerialNumber",label:"Old Serial Number",type:"text",conditionalOn:{field:"partReplaced",value:M}},{name:"newSerialNumber",label:"New Serial Number",type:"text",conditionalOn:{field:"partReplaced",value:M}},{name:"licensePlate",label:"License Plate",type:"text",conditionalOn:{field:"partReplaced",value:M}}],B=[{name:"actionsTaken",label:"Actions Taken",type:"textarea"},{name:"wasEscalated",label:"Was this ticket escalated?",type:"checkbox",hasConditionalFields:!0},{name:"escalatedTo",label:"Who was it escalated to?",type:"text",conditionalOn:{field:"wasEscalated",value:M}},{name:"seniorTechAlias",label:"Alias of the senior who approved this:",type:"text",conditionalOn:{field:"wasEscalated",value:M}}],L={breakfix:{title:"Break/Fix Task Notes",fields:[...P,...E,...B],format:(j)=>{return`TASK ID: ${j.taskId||"[No ID]"}
ASSET TAG CONFIRMED: ${_(j.assetTagConfirmed)}

UPON ARRIVAL:
${j.uponArrival||"[No arrival notes recorded]"}

ACTIONS TAKEN:
${j.actionsTaken||"[No actions recorded]"}

TICKET ESCALATED: ${_(j.wasEscalated)}${F(j)}`}},network:{title:"Network Task Notes",fields:[...P,{name:"sourceDevice",label:"Source Device:Port",type:"text"},{name:"endDevice",label:"End Device:Port",type:"text"},...E,...B],format:(j)=>{return`TASK ID: ${j.taskId||"[No ID]"}
ASSET TAG CONFIRMED: ${_(j.assetTagConfirmed)}

UPON ARRIVAL:
${j.uponArrival||"[No arrival notes recorded]"}
SOURCE DEVICE:PORT: ${j.sourceDevice||K}
END DEVICE:PORT: ${j.endDevice||K}

ACTIONS TAKEN:
${j.actionsTaken||"[No actions recorded]"}

TICKET ESCALATED: ${_(j.wasEscalated)}${F(j)}`}},dbd:{title:"DBD Task Notes",fields:[...P,...E,{name:"driveLocation",label:"Location of drive being replaced",type:"text",conditionalOn:{field:"partReplaced",value:M}},{name:"binNumber",label:"Bin #",type:"text",conditionalOn:{field:"partReplaced",value:M}},...B],format:(j)=>{return`TASK ID: ${j.taskId||"[No ID]"}
ASSET TAG CONFIRMED: ${_(j.assetTagConfirmed)}

UPON ARRIVAL:
${j.uponArrival||"[No arrival notes recorded]"}

ACTIONS TAKEN:
${j.actionsTaken||"[No actions recorded]"}

TICKET ESCALATED: ${_(j.wasEscalated)}${F(j)}`}},mobo:{title:"Motherboard Task Notes",fields:[...P,{name:"partReplaced",label:"Part(s) replaced?",type:"checkbox",hasConditionalFields:!0},{name:"oldSerialNumber",label:"Old Motherboard Serial Number",type:"text",conditionalOn:{field:"partReplaced",value:M}},{name:"newSerialNumber",label:"New Motherboard Serial Number",type:"text",conditionalOn:{field:"partReplaced",value:M}},{name:"licensePlate",label:"License Plate",type:"text",conditionalOn:{field:"partReplaced",value:M}},{name:"dbdMoved",label:"Were DBDs moved from old motherboard to new?",type:"checkbox",hasConditionalFields:!0},{name:"dbdSerialNumber",label:"DBD Serial Number",type:"text",conditionalOn:{field:"dbdMoved",value:M}},{name:"slotNumber",label:"Slot #",type:"text",conditionalOn:{field:"dbdMoved",value:M}},...B],format:(j)=>{return`TASK ID: ${j.taskId||"[No ID]"}
ASSET TAG CONFIRMED: ${_(j.assetTagConfirmed)}

UPON ARRIVAL:
${j.uponArrival||"[No arrival notes recorded]"}

ACTIONS TAKEN:
${j.actionsTaken||"[No actions recorded]"}

TICKET ESCALATED: ${_(j.wasEscalated)}${F(j)}`}},workwindow:{title:"Work Window Request Email",fields:[{type:"info",text:'You can confirm availability for a specific dates via <a href="https://dccentral.microsoft.com/tasks/query/advanced/30704" target="_blank">SN-DCCentral</a> for SN or <a href="https://dccentral.microsoft.com/tasks/query/advanced/31722" target="_blank">SAT-DCCentral</a> for SAT. Our work window policy can be found <a href="https://microsoft.sharepoint.com/:w:/r/teams/dcops/reflib/_layouts/15/Doc.aspx?sourcedoc=%7B34AC5FCF-C562-4F64-922F-AD9AED915DEA%7D&file=Work%20Window%20Policy.docx&wdOrigin=TEAMS-MAGLEV.teams_ns.rwc&action=default&mobileredirect=true" target="_blank">here</a> for reference.'},{name:"taskId",label:"Task ID",type:"text"},{name:"date",label:"Suggested Date",type:"text"},{name:"time",label:"Time of Availability",type:"text"},{type:"info",text:'If a task is quarantined, please direct the requestor to <a href="https://microsoft.sharepoint.com/sites/COIPartnerResourceCenter/SitePages/CO+-Partner-Resource-Center.aspx?ct=1748876712863&or=Teams-HL&ga=1&LOF=1&xsdata=MDV8MDJ8fDdlZjg4MTg4OGJiMjQ0MzBhMTFjMDhkZTFhMTY3ODAwfDcyZjk4OGJmODZmMTQxYWY5MWFiMmQ3Y2QwMTFkYjQ3fDB8MHw2Mzg5NzY4ODA5MzgxMTkxMDB8VW5rbm93bnxWR1ZoYlhOVFpXTjFjbWwwZVZObGNuWnBZMlY4ZXlKRFFTSTZJbFJsWVcxelgwRlVVRk5sY25acFkyVmZVMUJQVEU5R0lpd2lWaUk2SWpBdU1DNHdNREF3SWl3aVVDSTZJbGRwYmpNeUlpd2lRVTRpT2lKUGRHaGxjaUlzSWxkVUlqb3hNWDA9fDF8TDJOb1lYUnpMekU1T21KaVpHTm1OalUzTWpZNFpqUXhNVGs1Tm1Nek5UZGxObU16TnpFeFptTTNRSFJvY21WaFpDNTJNaTl0WlhOellXZGxjeTh4TnpZeU1Ea3hNamt5T0Rnd3w4YTcwMGYyOTdiZDE0NzE0YzkwNDA4ZGUxYTE2NzdmZnxlNzQ5NGE4MjI3NjI0N2Q5OGYwMTNlNDI2ZWFiMmI5ZA%3D%3D&sdata=ZGtMSy9JZVhOYlRFRnFHV1M0MlFWc1pQbEp1OXArZWdoSnpBVGY0bDlUbz0%3D&ovuser=72f988bf-86f1-41af-91ab-2d7cd011db47%2Caguajardo%40microsoft.com&OR=Teams-HL&CT=1762904435825&clickparams=eyJBcHBOYW1lIjoiVGVhbXMtRGVza3RvcCIsIkFwcFZlcnNpb24iOiI0OS8yNTExMDYxMzYwMSIsIkhhc0ZlZGVyYXRlZFVzZXIiOmZhbHNlfQ%3D%3D" target="_blank">the CO&I Partner Resource Center</a> for further instructions on how to proceed with scheduling work windows for quarantined tasks.'}],format:(j)=>{return`WORK WINDOW REQUEST - TASK ID: ${j.taskId||"TaskIdHolder"}

Hello,

We are writing to schedule a work window for Task #${j.taskId||"TaskIdHolder"}. We are available to begin a work window between 09:00 AM CST and 02:00 PM CST or 09:00 PM CST and 02:00 AM CST. Our next available window is available for ${j.date||"DATE"} at ${j.time||"TIME"}. Please confirm whether this time is acceptable for your team.

Important considerations:
• A minimum of 24 hours' notice is required for all work windows to ensure System Services can confirm availability and prepare accordingly.
• Prompt confirmation is essential. Delayed replies may result in the proposed time slot becoming unavailable, as our resources are limited and we cannot reserve slots indefinitely.
• Please ensure all necessary traffic is removed or rerouted prior to the work window start time to facilitate a timely and efficient completion of the requested work.

We appreciate your prompt attention to this matter.`}},workAuth:{title:"Work Authorization Request",fields:[{name:"taskId",label:"Task ID",type:"text"},{name:"taskLink",label:"Task Link",type:"text"},{name:"sourceDevice",label:"Source Device:Port",type:"text"},{name:"expectedHop",label:"Expected Hop (leave empty if unknown)",type:"text"},{name:"endDevice",label:"End Device:Port",type:"text"},{name:"actionsTaken",label:"Actions being taken",type:"text"},{name:"assetTagConfirmed",label:"Was the asset tag visually confirmed?",type:"checkbox"},{name:"labelConfirmed",label:"Was the cable label visually confirmed?",type:"checkbox"},{name:"secondTech",label:"Alias of Second Tech QC",type:"text"}],format:(j)=>{return`LINK APPROVAL REQUEST - TASK ID: ${j.taskId||"N/A"}

Task Link: ${j.taskLink||"N/A"}
Source Device:Port: ${j.sourceDevice||"N/A"}
Expected Hop: ${j.expectedHop||"N/A"}
End Device:Port: ${j.endDevice||"N/A"}
Required Actions: ${j.actionsTaken||"N/A"}

Asset Tag Confirmed: ${_(j.assetTagConfirmed)}
Cable Label Verified: ${_(j.labelConfirmed)}
2nd Tech QC Alias: ${j.secondTech||"N/A"}`}}},O="breakfix",A=0,v=0,H=document.getElementById("template-form"),o=document.getElementById("preview"),n=document.getElementById("template-select"),Gj=document.getElementById("copy-btn"),Nj=document.getElementById("reset-btn"),m=document.getElementById("copy-message"),l=document.getElementById("app"),i=document.getElementById("details-panel"),x=document.getElementById("details-content"),U=new Set;jj();Yj();Zj("#template-select-wrapper");n.addEventListener("change",Uj);Gj.addEventListener("click",Lj);Nj.addEventListener("click",Aj);function Oj(){i.classList.add("visible"),l.classList.add("has-details")}function D(){i.classList.remove("visible"),l.classList.remove("has-details"),x.innerHTML="",U.clear()}function Mj(){if(x.innerHTML="",U.size===0){D();return}Oj(),U.forEach((j)=>{Hj(j)})}var w=document.getElementById("mode-toggle"),d=document.getElementById("animation-toggle"),a=document.querySelectorAll('.color-buttons[data-color-type="primary"] .color-btn'),t=document.querySelectorAll('.color-buttons[data-color-type="secondary"] .color-btn'),_j=document.getElementById("settings-btn"),S=document.getElementById("settings-modal"),Kj=document.getElementById("modal-close"),Vj={blue:222,purple:280,green:145,red:0,orange:30,cyan:190},h=localStorage.getItem("darkMode")==="true",k=localStorage.getItem("primaryColor")||"blue",R=localStorage.getItem("secondaryColor")||"none",I=localStorage.getItem("animatedBackground")!=="false";y();_j.addEventListener("click",()=>{S.classList.add("show")});Kj.addEventListener("click",()=>{S.classList.remove("show")});S.addEventListener("click",(j)=>{if(j.target===S)S.classList.remove("show")});w.addEventListener("click",function(){h=!h,localStorage.setItem("darkMode",h),y()});d.addEventListener("click",function(){I=!I,localStorage.setItem("animatedBackground",I),e()});function e(){if(d.textContent=I?"▶️":"⏸️",window.waveBackground)window.waveBackground.setAnimated(I)}e();a.forEach((j)=>{j.addEventListener("click",function(){k=this.getAttribute("data-color"),localStorage.setItem("primaryColor",k),y()})});t.forEach((j)=>{j.addEventListener("click",function(){R=this.getAttribute("data-color"),localStorage.setItem("secondaryColor",R),y()})});function y(){if(h)document.body.classList.add("dark-mode"),w.textContent="\uD83C\uDF19";else document.body.classList.remove("dark-mode"),w.textContent="☀️";if(document.body.classList.remove("primary-blue","primary-purple","primary-green","primary-red","primary-orange","primary-cyan","secondary-blue","secondary-purple","secondary-green","secondary-red","secondary-orange","secondary-cyan"),document.body.classList.add(`primary-${k}`),R!=="none")document.body.classList.add(`secondary-${R}`),document.documentElement.style.removeProperty("--hue2");else document.documentElement.style.setProperty("--hue2",Vj[k]);if(a.forEach((j)=>{j.classList.toggle("active",j.getAttribute("data-color")===k)}),t.forEach((j)=>{j.classList.toggle("active",j.getAttribute("data-color")===R)}),window.waveBackground)window.waveBackground.updateTheme()}function Uj(){let j=O,z=n.value,Q=j==="network"&&z==="workAuth"||j==="workAuth"&&z==="network",J={};if(Q)L[j].fields.forEach(($)=>{if($.name){let W=document.getElementById($.name);if(W)if($.type==="checkbox")J[$.name]=W.checked;else J[$.name]=W.value}});if(O=z,jj(),Q)L[O].fields.forEach(($)=>{if($.name&&J[$.name]!==void 0){let W=document.getElementById($.name);if(W)if($.type==="checkbox"){if(W.checked=J[$.name],$.hasConditionalFields)zj(W)}else W.value=J[$.name]}});N()}function jj(){H.innerHTML="",A=0,v=0;let j=L[O],z=[],Q=[],J=[],Y=!1;j.fields.forEach((W)=>{if(W.conditionalOn)return;if(W.type==="info")if(Y)Q.push(W);else z.push(W);else Y=!0,J.push(W)}),z.forEach((W)=>{let X=c(W.text||W.label);X.style.marginBottom="15px",H.appendChild(X)});let $=document.createElement("tbody");if(J.forEach((W)=>{let X=document.createElement("tr"),Z=document.createElement("td"),q=document.createElement("label");q.setAttribute("for",W.name),q.textContent=W.label,Z.appendChild(q);let G=document.createElement("td"),V=r(W);if(W.type==="checkbox"&&W.hasConditionalFields)V.addEventListener("change",function(){zj(this),N()});else if(W.type==="select"&&W.hasConditionalFields)V.addEventListener("change",Ij);else if(W.type==="select")V.addEventListener("change",N);else V.addEventListener("input",N);G.appendChild(V),X.appendChild(Z),X.appendChild(G),$.appendChild(X)}),$.children.length>0)H.appendChild($);Q.forEach((W)=>{let X=c(W.text||W.label);X.style.marginTop="15px",H.appendChild(X)}),D()}function zj(j){if(j.checked)U.add(j.id);else{if(U.delete(j.id),j.id==="partReplaced")A=0;if(j.id==="dbdMoved")v=0}Mj()}function Hj(j){let z=L[O],Q=document.createElement("div");if(Q.className="details-section",Q.dataset.sectionId=j,U.size>1){let J=document.createElement("h4");if(J.className="section-subheader",j==="partReplaced")J.textContent="Parts Replacement";if(j==="wasEscalated")J.textContent="Escalation Details";if(j==="dbdMoved")J.textContent="DBD Information";Q.appendChild(J)}if(j==="partReplaced"&&["breakfix","dbd","network","mobo"].includes(O)){if(O==="dbd"){let W=document.createElement("h4");W.className="details-section-label",W.textContent="Replaced DBDs",Q.appendChild(W)}let J=document.createElement("table");if(J.id="parts-table",J.className="parts-table",O!=="dbd"){let W=document.createElement("thead"),X=document.createElement("tr");["Old Serial","New Serial","License Plate",""].forEach((q)=>{let G=document.createElement("th");G.textContent=q,X.appendChild(G)}),W.appendChild(X),J.appendChild(W)}let Y=document.createElement("tbody");Y.id="parts-table-body",Y.appendChild(Jj(0)),J.appendChild(Y),Q.appendChild(J);let $=document.createElement("div");$.className="add-more-link",$.textContent="+ Add Another Part",$.addEventListener("click",Sj),Q.appendChild($)}if(j==="dbdMoved"&&O==="mobo"){let J=document.createElement("table");J.id="dbds-table",J.className="parts-table";let Y=document.createElement("thead"),$=document.createElement("tr");["DBD Serial","Slot #",""].forEach((q)=>{let G=document.createElement("th");G.textContent=q,$.appendChild(G)}),Y.appendChild($),J.appendChild(Y);let X=document.createElement("tbody");X.id="dbds-table-body",X.appendChild(Qj(0)),J.appendChild(X),Q.appendChild(J);let Z=document.createElement("div");Z.className="add-more-link",Z.textContent="+ Add Another DBD",Z.addEventListener("click",kj),Q.appendChild(Z)}if(j==="wasEscalated")z.fields.filter((Y)=>Y.conditionalOn&&Y.conditionalOn.field==="wasEscalated").forEach((Y)=>{let $=document.createElement("div");$.className="form-group";let W=document.createElement("label");W.setAttribute("for",Y.name),W.textContent=Y.label;let X=r(Y);X.addEventListener("input",N),$.appendChild(W),$.appendChild(X),Q.appendChild($)});x.appendChild(Q)}function Jj(j){if(O==="dbd"){let $=document.createDocumentFragment(),W=document.createElement("tr");W.dataset.rowIndex=j,W.className="parts-row-primary";let X=document.createElement("td"),Z=document.createElement("input");Z.type="text",Z.name=`oldSerialNumber${j}`,Z.id=`oldSerialNumber${j}`,Z.placeholder="Old Serial",Z.addEventListener("input",N),X.appendChild(Z),W.appendChild(X),X=document.createElement("td"),Z=document.createElement("input"),Z.type="text",Z.name=`newSerialNumber${j}`,Z.id=`newSerialNumber${j}`,Z.placeholder="New Serial",Z.addEventListener("input",N),X.appendChild(Z),W.appendChild(X),X=document.createElement("td"),Z=document.createElement("input"),Z.type="text",Z.name=`licensePlate${j}`,Z.id=`licensePlate${j}`,Z.placeholder="LP",Z.addEventListener("input",N),X.appendChild(Z),W.appendChild(X),X=document.createElement("td"),X.rowSpan=2;let q=document.createElement("button");q.type="button",q.className="delete-row-btn",q.textContent="×",q.addEventListener("click",function(){u(W,G)}),X.appendChild(q),W.appendChild(X);let G=document.createElement("tr");return G.dataset.rowIndex=j,G.className="parts-row-secondary",X=document.createElement("td"),X.colSpan=2,Z=document.createElement("input"),Z.type="text",Z.name=`driveLocation${j}`,Z.id=`driveLocation${j}`,Z.placeholder="Drive Location",Z.addEventListener("input",N),X.appendChild(Z),G.appendChild(X),X=document.createElement("td"),Z=document.createElement("input"),Z.type="text",Z.name=`binNumber${j}`,Z.id=`binNumber${j}`,Z.placeholder="Bin #",Z.addEventListener("input",N),X.appendChild(Z),G.appendChild(X),$.appendChild(W),$.appendChild(G),$}let z=document.createElement("tr");z.dataset.rowIndex=j;let Q=document.createElement("td"),J=document.createElement("input");J.type="text",J.name=`oldSerialNumber${j}`,J.id=`oldSerialNumber${j}`,J.addEventListener("input",N),Q.appendChild(J),z.appendChild(Q),Q=document.createElement("td"),J=document.createElement("input"),J.type="text",J.name=`newSerialNumber${j}`,J.id=`newSerialNumber${j}`,J.addEventListener("input",N),Q.appendChild(J),z.appendChild(Q),Q=document.createElement("td"),J=document.createElement("input"),J.type="text",J.name=`licensePlate${j}`,J.id=`licensePlate${j}`,J.addEventListener("input",N),Q.appendChild(J),z.appendChild(Q),Q=document.createElement("td");let Y=document.createElement("button");return Y.type="button",Y.className="delete-row-btn",Y.textContent="×",Y.addEventListener("click",function(){u(z)}),Q.appendChild(Y),z.appendChild(Q),z}function Sj(){A++;let j=document.getElementById("parts-table-body");if(j)j.appendChild(Jj(A)),N()}function u(j,z=null){let Q=document.getElementById("parts-table-body"),J=O==="dbd"?2:1;if(Q&&Q.children.length>J){if(j.remove(),z)z.remove();N()}}function Qj(j){let z=document.createElement("tr");z.dataset.rowIndex=j;let Q=document.createElement("td"),J=document.createElement("input");J.type="text",J.name=`dbdSerialNumber${j}`,J.id=`dbdSerialNumber${j}`,J.addEventListener("input",N),Q.appendChild(J),z.appendChild(Q),Q=document.createElement("td"),J=document.createElement("input"),J.type="text",J.name=`slotNumber${j}`,J.id=`slotNumber${j}`,J.addEventListener("input",N),Q.appendChild(J),z.appendChild(Q),Q=document.createElement("td");let Y=document.createElement("button");return Y.type="button",Y.className="delete-row-btn",Y.textContent="×",Y.addEventListener("click",function(){Rj(z)}),Q.appendChild(Y),z.appendChild(Q),z}function kj(){v++;let j=document.getElementById("dbds-table-body");if(j)j.appendChild(Qj(v)),N()}function Rj(j){let z=document.getElementById("dbds-table-body");if(z&&z.children.length>1)j.remove(),N()}function Ij(j){let z=j.target,Q=z.value;document.querySelectorAll(`.conditional-field[data-depends-on="${z.id}"]`).forEach((Y)=>{let $=Y.getAttribute("data-depends-value");if(Q===$)Y.style.display="block";else Y.style.display="none",Y.querySelectorAll("input, textarea, select").forEach((X)=>X.value="")}),N()}function N(){let j={},z=L[O];if(z.fields.forEach((J)=>{let Y=document.getElementById(J.name);if(Y)if(J.type==="checkbox")j[J.name]=Y.checked?M:"";else j[J.name]=Y.value}),["breakfix","dbd","network","mobo"].includes(O)){j.allParts=[];let J=document.getElementById("parts-table-body");if(J){let Y=O==="dbd"?"tr.parts-row-primary":"tr";J.querySelectorAll(Y).forEach((W,X)=>{let Z=W.dataset.rowIndex,q=document.getElementById(`oldSerialNumber${Z}`),G=document.getElementById(`newSerialNumber${Z}`),V=document.getElementById(`licensePlate${Z}`);if(q&&G&&V){let g={id:X+1,oldSerialNumber:q.value,newSerialNumber:G.value,licensePlate:V.value};if(O==="dbd"){let b=document.getElementById(`driveLocation${Z}`),f=document.getElementById(`binNumber${Z}`);if(b)g.driveLocation=b.value;if(f)g.binNumber=f.value}j.allParts.push(g)}})}}if(O==="mobo"){j.allDBDs=[];let J=document.getElementById("dbds-table-body");if(J)J.querySelectorAll("tr").forEach(($,W)=>{let X=$.dataset.rowIndex,Z=document.getElementById(`dbdSerialNumber${X}`),q=document.getElementById(`slotNumber${X}`);if(Z&&q){let G={id:W+1,dbdSerialNumber:Z.value,slotNumber:q.value};j.allDBDs.push(G)}})}let Q=z.format(j);if(["breakfix","dbd","network","mobo"].includes(O)&&j.partReplaced===M&&j.allParts&&j.allParts.length>0)Q+=$j(j.allParts,O);if(O==="mobo"&&j.dbdMoved===M&&j.allDBDs&&j.allDBDs.length>0)Q+=qj(j.allDBDs);o.textContent=Q}function Lj(){let j=o.textContent;if(navigator.clipboard&&navigator.clipboard.writeText)navigator.clipboard.writeText(j).then(()=>Wj()).catch(()=>s(j));else s(j)}function Wj(){m.classList.add("show"),setTimeout(()=>{m.classList.remove("show")},2000)}function s(j){try{let z=document.createElement("textarea");z.value=j,z.style.position="fixed",z.style.left="-999999px",z.style.top="-999999px",document.body.appendChild(z),z.focus(),z.select();let Q=document.execCommand("copy");if(document.body.removeChild(z),Q)Wj();else console.error("Fallback: Could not copy text"),alert("Could not copy text. Please select the text manually.")}catch(z){console.error("Fallback: Could not copy text",z),alert("Could not copy text. Please select the text manually.")}}function Aj(){H.reset(),document.querySelectorAll('#template-form input[type="checkbox"]').forEach((j)=>{j.checked=!1}),D(),A=0,v=0,N()}
